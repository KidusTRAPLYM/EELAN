<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google Sign-In client ID -->
    <meta
      name="google-signin-client_id"
      content="YOUR_CLIENT_ID.apps.googleusercontent.com"
    />

    <!-- Google Platform Library -->
    <script src="https://apis.google.com/js/platform.js" async defer></script>

    <title>Chat with Google Sign-In</title>

    <style>
      body {
        font-family: "Poppins", sans-serif;
        margin: 2rem;
        background: #f9f9f9;
        color: #111;
      }
      #chatContainer {
        max-width: 500px;
        margin-top: 2rem;
      }
      #messageList {
        list-style: none;
        padding: 0;
        height: 200px;
        overflow-y: auto;
        background: white;
        border: 1px solid #ccc;
        border-radius: 8px;
        margin-bottom: 1rem;
      }
      #messageList li {
        padding: 8px 12px;
        border-bottom: 1px solid #eee;
      }
      #form {
        display: flex;
        gap: 0.5rem;
      }
      #text {
        flex-grow: 1;
        padding: 10px 15px;
        border-radius: 25px;
        border: 1px solid #ccc;
        font-size: 1rem;
      }
      #sendBtn {
        padding: 10px 20px;
        border-radius: 25px;
        border: none;
        background: #2563eb;
        color: white;
        font-weight: bold;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h2>Sign in to chat</h2>

    <!-- Google Sign-In button -->
    <div class="g-signin2" data-onsuccess="onSignIn"></div>

    <!-- Sign out button -->
    <button
      onclick="signOut()"
      style="margin-top: 10px; display: none"
      id="signOutBtn"
    >
      Sign Out
    </button>

    <div id="chatContainer" style="display: none">
      <ul id="messageList"></ul>
      <form id="form">
        <input
          type="text"
          id="text"
          autocomplete="off"
          placeholder="Type a message..."
        />
        <button type="submit" id="sendBtn">Send</button>
      </form>
    </div>

    <script>
      let currentUser = null;

      function onSignIn(googleUser) {
        const profile = googleUser.getBasicProfile();
        currentUser = {
          id: profile.getId(),
          name: profile.getName(),
          email: profile.getEmail(),
        };
        console.log("User signed in:", currentUser);

        // Show chat UI and sign out button
        document.getElementById("chatContainer").style.display = "block";
        document.getElementById("signOutBtn").style.display = "inline-block";
        // Hide sign in button
        document.querySelector(".g-signin2").style.display = "none";

        addSystemMessage(`Welcome, ${currentUser.name}! You can now chat.`);
      }

      function signOut() {
        const auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(() => {
          console.log("User signed out.");
          currentUser = null;
          document.getElementById("chatContainer").style.display = "none";
          document.getElementById("signOutBtn").style.display = "none";
          document.querySelector(".g-signin2").style.display = "block";
          clearMessages();
        });
      }

      // Chat message handling
      const form = document.getElementById("form");
      const messageList = document.getElementById("messageList");
      const input = document.getElementById("text");

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        if (!currentUser) {
          alert("Please sign in first!");
          return;
        }
        const msg = input.value.trim();
        if (msg === "") return;
        addMessage(currentUser.name, msg);
        input.value = "";
      });

      function addMessage(user, text) {
        const li = document.createElement("li");
        li.textContent = `${user}: ${text}`;
        messageList.appendChild(li);
        messageList.scrollTop = messageList.scrollHeight;
      }

      function addSystemMessage(text) {
        const li = document.createElement("li");
        li.textContent = text;
        li.style.fontStyle = "italic";
        li.style.color = "#555";
        messageList.appendChild(li);
        messageList.scrollTop = messageList.scrollHeight;
      }

      function clearMessages() {
        messageList.innerHTML = "";
      }
    </script>
  </body>
</html>
